<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>
    Mysqli 使用 | NIUHE | Be Myself Enjoy My Life
  </title>

  
  <meta name="author" content="NIUHE">
  

  
  <meta name="description" content="NIUHE&#39;s Blog">
  

  
  <meta name="keywords" content="编程,读书,学习笔记">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  
  <meta property="og:title" content="Mysqli 使用">
  

  <meta property="og:site_name" content="NIUHE">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/icon.png" type="image/png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="NIUHE" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <script type="text/javascript" src="/js/social-share.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-71540601-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-71540601-1');
</script>


<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="blog">
    <div class="content">

      <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">NIUHE</a>
    </h1>
    <p class="site-description">Be Myself Enjoy My Life</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">目录</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/tags">标签</a></li>
      
    </ul>
  </nav>
</header>

      <main class="site-main posts-loop">
        <article>

  
  
  <h3 class="article-title"><span>
      Mysqli 使用</span></h3>
  
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/12/19/Mysqli 使用/" rel="bookmark">
        <time class="entry-date published" datetime="2015-12-19T10:35:40.000Z">
          2015-12-19
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
      <h3><span id="连接数据库并获取相关信息">连接数据库并获取相关信息</span></h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$mysqli=@<span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>, <span class="string">"mysql"</span>);</span><br><span class="line"><span class="comment">//如果连接错误</span></span><br><span class="line"><span class="keyword">if</span>(mysqli_connect_errno())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"连接数据库失败："</span>.mysqli_connect_error();</span><br><span class="line">    $mysqli=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取当前字符集</span></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;character_set_name().<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//获取客户端信息</span></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;get_client_info().<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//获取mysql主机信息</span></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;host_info.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//获取服务器信息</span></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;server_info.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//获取服务器版本</span></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;server_version.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//关闭数据库连接</span></span><br><span class="line">$mysqli-&gt;close();</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3><span id="查询数据">查询数据</span></h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造SQL语句</span></span><br><span class="line">$query = <span class="string">"SELECT * FROM  designer order by ID LIMIT 3"</span>;</span><br><span class="line"><span class="comment">//执行SQL语句</span></span><br><span class="line">$result = $mysqli-&gt;query($query);</span><br><span class="line"><span class="comment">//遍历结果</span></span><br><span class="line"><span class="keyword">while</span>($row = $result-&gt;fetch_array(MYSQLI_BOTH))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"id"</span>.$row[<span class="string">'id'</span>].<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//释放结果集</span></span><br><span class="line">$result-&gt;free();</span><br></pre></td></tr></table></figure>
<p>在这里需要注意的是 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch_array(MYSQLI_BOTH)</span><br></pre></td></tr></table></figure></p>
<p>这个方法，参数有三个，分别是 <code>MYSQLI_BOTH</code>，<code>MYSQLI_NUM</code>，<code>MYSQLI_ASSOC</code>。</p>
<p>如果参数传入了 <code>MYSQLI_BOTH</code>，返回数组的索引既包括数字和名称。 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span> (size=<span class="number">26</span>)</span><br><span class="line">  <span class="number">0</span> =&gt; string <span class="string">'10062'</span> (length=<span class="number">5</span>)</span><br><span class="line">  <span class="string">'id'</span> =&gt; string <span class="string">'10062'</span> (length=<span class="number">5</span>)</span><br><span class="line">  <span class="number">1</span> =&gt; string <span class="string">'??'</span> (length=<span class="number">2</span>)</span><br><span class="line">  <span class="string">'name'</span> =&gt; string <span class="string">'??'</span> (length=<span class="number">2</span>)</span><br><span class="line">  <span class="number">2</span> =&gt; string <span class="string">'1016903103@qq.com'</span> (length=<span class="number">17</span>)</span><br><span class="line">  <span class="string">'email'</span> =&gt; string <span class="string">'1016903103@qq.com'</span> (length=<span class="number">17</span>)</span><br><span class="line">  <span class="number">3</span> =&gt; string <span class="string">'18366119732'</span> (length=<span class="number">11</span>)</span><br><span class="line">  <span class="string">'phone'</span> =&gt; string <span class="string">'18366119732'</span> (length=<span class="number">11</span>)</span><br></pre></td></tr></table></figure></p>
<p>如果参数传入了 <code>MYSQLI_NUM</code>，返回数组的索引只包含数字。 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span> (size=<span class="number">13</span>)</span><br><span class="line">  <span class="number">0</span> =&gt; string <span class="string">'10062'</span> (length=<span class="number">5</span>)</span><br><span class="line">  <span class="number">1</span> =&gt; string <span class="string">'??'</span> (length=<span class="number">2</span>)</span><br><span class="line">  <span class="number">2</span> =&gt; string <span class="string">'1016903103@qq.com'</span> (length=<span class="number">17</span>)</span><br><span class="line">  <span class="number">3</span> =&gt; string <span class="string">'18366119732'</span> (length=<span class="number">11</span>)</span><br></pre></td></tr></table></figure></p>
<p>如果参数传入了 <code>MYSQLI_BOTH</code>，返回数组的索引只包含名称。 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span> (size=<span class="number">13</span>)</span><br><span class="line">  <span class="string">'id'</span> =&gt; string <span class="string">'10062'</span> (length=<span class="number">5</span>)</span><br><span class="line">  <span class="string">'name'</span> =&gt; string <span class="string">'??'</span> (length=<span class="number">2</span>)</span><br><span class="line">  <span class="string">'email'</span> =&gt; string <span class="string">'1016903103@qq.com'</span> (length=<span class="number">17</span>)</span><br><span class="line">  <span class="string">'phone'</span> =&gt; string <span class="string">'18366119732'</span> (length=<span class="number">11</span>)</span><br></pre></td></tr></table></figure></p>
<p>其实还有等价的方法 <code>fetch_row()</code>，<code>fetch_assoc()</code> 他们之间的关系如下 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   $result-&gt;fetch_row() </span><br><span class="line">=  mysql_fetch_row() </span><br><span class="line">=  $result-&gt;fetch_array(MYSQLI_NUM) </span><br><span class="line">=  mysql_fetch_array(MYSQLI_NUM)  </span><br><span class="line">返回索引数组</span><br><span class="line"></span><br><span class="line">   $result-&gt;fetch_assoc() </span><br><span class="line">=  mysql_fetch_assoc() </span><br><span class="line">=  $result-&gt;fetch_array(MYSQLI_ASSOC) </span><br><span class="line">=  mysql_fetch_array(MYSQLI_ASSOC)  </span><br><span class="line">返回索引列名</span><br></pre></td></tr></table></figure></p>
<h3><span id="插入数据">插入数据</span></h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line">$sql=<span class="string">"insert into designer(name,phone) values('hello','18352682923')"</span>;</span><br><span class="line"><span class="comment">//执行插入语句</span></span><br><span class="line">$result=$mysqli-&gt;query($sql);</span><br><span class="line"><span class="comment">//如果执行错误</span></span><br><span class="line"><span class="keyword">if</span>(!$result)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"SQL语句有误&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"ERROR:"</span>.$mysqli-&gt;errno.<span class="string">"|"</span>.$mysqli-&gt;error;</span><br><span class="line">    <span class="keyword">exit</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果插入成功，则返回影响的行数</span></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;affected_rows;</span><br></pre></td></tr></table></figure>
<h3><span id="更新数据">更新数据</span></h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新数据</span></span><br><span class="line">$sql=<span class="string">"update designer set name = 'hello' where id = 10062"</span>;</span><br><span class="line"><span class="comment">//执行插入语句</span></span><br><span class="line">$result=$mysqli-&gt;query($sql);</span><br><span class="line"><span class="comment">//如果执行错误</span></span><br><span class="line"><span class="keyword">if</span>(!$result)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"SQL语句有误&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"ERROR:"</span>.$mysqli-&gt;errno.<span class="string">"|"</span>.$mysqli-&gt;error;</span><br><span class="line">    <span class="keyword">exit</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果插入成功，则返回影响的行数</span></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;affected_rows;</span><br></pre></td></tr></table></figure>
<h3><span id="预处理语句">预处理语句</span></h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//准备好一条语句放到服务器中，插入语句</span></span><br><span class="line">$sql = <span class="string">"insert into designer(name, email) values(?, ?)"</span>;</span><br><span class="line"><span class="comment">//生成预处理语句</span></span><br><span class="line">$stmt = $mysqli-&gt;prepare($sql);</span><br><span class="line"><span class="comment">//给占位符号每个?号传值（绑定参数） i  d  s  b，第一个参数为格式化字符，ss代表两个字符串，d代表数字</span></span><br><span class="line">$stmt-&gt;bind_param(<span class="string">"ss"</span>, $name, $email);</span><br><span class="line"><span class="comment">//为变量赋值</span></span><br><span class="line">$name = <span class="string">"Mike"</span>;</span><br><span class="line">$email = <span class="string">"mike@live.cn"</span>;</span><br><span class="line"><span class="comment">//执行</span></span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line"><span class="comment">//为变量赋值</span></span><br><span class="line">$name = <span class="string">"Larry"</span>;</span><br><span class="line">$email = <span class="string">"larry@live.cn"</span>;</span><br><span class="line"><span class="comment">//执行</span></span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line"><span class="comment">//最后输出</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"最后ID"</span>.$stmt-&gt;insert_id.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"影响了"</span>.$stmt-&gt;affected_rows.<span class="string">"行&lt;br&gt;"</span>;</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

      
      

      <span class="post-categories">
        <i class="icon-categories"></i>
        <a href="/categories/学习笔记/">学习笔记</a>
      </span>
      

      
      

      <span class="post-tags">
        <i class="icon-tags"></i>
        <a href="/tags/后台开发/">后台开发</a><a href="/tags/PHP/">PHP</a><a href="/tags/MySQL/">MySQL</a>
      </span>
      

    </div>

    
  </div>
</article>

<div class="social-share"></div>


	<section id="comment" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'Niuhe';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>



      </main>

      <footer class="site-footer">
  <p class="site-info">
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    <br>
    
    &copy;
    2018
    NIUHE <a href="https://github.com/NeymarL" target="_blank"><i class="fab fa-github"></i></a>
    
  </p>
</footer>
      
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
        tex2jax: {
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
  </script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });
  </script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

      <script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
    </div>
  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>

</html>